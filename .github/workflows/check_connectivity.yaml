name: Self-Hosted Runner Health Check

# Runs every 5 minutes
on:
  schedule:
    - cron: '*/5 * * * *'

# Workflow permissions (optional now, PAT has full access)
permissions:
  actions: read

jobs:
  check-runners:
    runs-on: ubuntu-latest
    env:
      REPO: ${{ github.repository }}
      GITHUB_TOKEN: ${{ secrets.MY_GITHUB_PAT }}  # <- Use PAT here
    steps:
      - name: Debug GitHub API response
        run: |
          echo "Fetching self-hosted runners for $REPO..."
          RESPONSE=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            https://api.github.com/repos/$REPO/actions/runners)
          
          echo "Listing runners safely:"
          echo "$RESPONSE" | jq -r '.runners // [] | .[] | "\(.name) (\(.os)) - \(.status)"' \
            | while read line; do
                echo "$line"
                if [[ "$line" != *"online"* ]]; then
                  echo "⚠️ Offline!"
                fi
              done
